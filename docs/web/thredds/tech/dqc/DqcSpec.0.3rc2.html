<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Dataset Query Capabilities Specification</title>
</head>
<body>
<h1>Dataset Query Capabilities Document Specification</h1>
<p> <em>Last modified: 4 December 2003 </em></p>
<p><em>Comments to <a href="mailto:thredds@unidata.ucar.edu">THREDDS
mail list</a> </em> </p>
<hr>
<p> A Dataset Query Capabilities (DQC) document is an XML document that
follows the query capabilities Schema. A DQC document describes the set
of requests that can be made to one or more DQC services and the form
of those requests. This DQC Document Spec describes what constitutes a
DQC document and how a DQC service request is built from the
information in a DQC document.<br>
</p>
<p>&nbsp;This DQC Document Specification covers the 0.3 version of the
query capabilities schema (<a
 href="/schemas/thredds/queryCapabilities.0.3.xsd">http://www.unidata.ucar.edu/schemas/thredds/queryCapabilities.0.3.xsd</a>).
</p>
<h2>How to Reference a DQC Document</h2>
<p>A DQC document is returned when a THREDDS InvCatalog dataset is
accessed via an access
method of serviceType "QueryCapability". [<span
 style="color: rgb(255, 0, 0);">So, in some sense the dataset is
described by the DQC document. Or, in anothe sense, the DQC is simply
another method for building an access method to the dataset. Or, in yet
another sense, the DQC is a deffered access method for the dataset</span>]<br>
</p>
<h2>DQC Elements and Attributes</h2>
<a name="queryCapability"></a>
<h3>queryCapability Element</h3>
<pre>&lt;xsd:element name="queryCapability"&gt;<br>  &lt;xsd:complexType&gt;<br>    &lt;xsd:sequence&gt;<br>      &lt;xsd:element ref="qc:query"/&gt;<br>      &lt;xsd:element ref="qc:selector" minOccurs="1" maxOccurs="unbounded" /&gt;<br>      &lt;xsd:element ref="qc:userInterface" minOccurs="0" maxOccurs="unbounded"/&gt;<br>    &lt;/xsd:sequence&gt;<br>    &lt;xsd:attribute name="version" type="xsd:token" default="0.3"/&gt;<br>    &lt;xsd:attribute name="name" type="xsd:token" use="optional"/&gt;<br>  &lt;/xsd:complexType&gt;<br>&lt;/xsd:element&gt;<br></pre>
<p>This is the top level element, containing
one <strong style="font-style: italic;">query</strong>
element, one or more <strong style="font-style: italic;"> selector</strong>
elements, and 0 or
more <strong></strong><strong style="font-style: italic;"><a
 href="file:///C:/Documents%20and%20Settings/edavis/Desktop/DqcSpec.new.html#userInterface">userInterface</a></strong>
elements. For example,<br>
</p>
<pre>&lt;queryCapability&gt;<br>  &lt;query base&gt;<br>  ...<br>&lt;/queryCapability&gt;<br></pre>
<p> </p>
<a name="query"></a>
<h3>query Element</h3>
<pre>&lt;xsd:element name="query" type="qc:queryType"/&gt;<br>&lt;xsd:complexType name="queryType"&gt;<br><span
 style="color: rgb(255, 0, 0);">  &lt;xsd:sequence&gt;</span><br
 style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    &lt;xsd:element ref="qc:resolverDataset" use="required" /&gt;   &lt;!-- Required? No default? Default access type is "catalog"? --&gt;<br>                                                          &lt;!-- Does this replace the returns attribute? And the base attribute? --&gt;<br
 style="color: rgb(255, 0, 0);"></span><span
 style="color: rgb(255, 0, 0);">  &lt;/xsd:sequence&gt;</span><br
 style="color: rgb(255, 0, 0);"> &nbsp;&lt;xsd:attribute name="base" type="xsd:string" use="required"/&gt;<br>  &lt;xsd:attribute name="construct" type="qc:constructType" use="required"/&gt;<br>  &lt;xsd:attribute name="returns" type="qc:returnsType" default="catalog"/&gt;<br>&lt;/xsd:complexType&gt;<br><br>&lt;xsd:simpleType name="constructType"&gt;<br>  &lt;xsd:restriction base="xsd:token"&gt;<br>    &lt;xsd:enumeration value="paramValue" /&gt;<br>    &lt;xsd:enumeration value="template" /&gt;<br>  &lt;/xsd:restriction&gt;<br>&lt;/xsd:simpleType&gt;<br><br>&lt;xsd:simpleType name="returnsType"&gt;<br>  &lt;xsd:restriction base="xsd:token"&gt;<br>    &lt;xsd:enumeration value="catalog"/&gt;<br><span
 style="color: rgb(255, 0, 0);">    &lt;xsd:enumeration value="queryCapability"/&gt;</span><br>   &nbsp;&lt;!-- xsd:enumeration value="dataset" /&gt; See discussion <a
 href="#whatReturned">below</a>.--&gt;<br>    &lt;xsd:enumeration value="other"/&gt;<br>  &lt;/xsd:restriction&gt;<br>&lt;/xsd:simpleType&gt;<br><br></pre>
<p>A <strong><em>query</em></strong> element provides the initial part
of the query and defines what the query returns. The <em><strong>base</strong></em>
attribute becomes the base of the query. The <em><strong>returns</strong></em>
attribute defines what the query will return; currently only "<strong><em>catalog</em></strong>"
and "<span style="font-weight: bold;">other</span>"
are defined.<br>
</p>
<p>How the query string is constructed depends on the value of the <span
 style="font-style: italic;"><span style="font-weight: bold;">construct</span></span>
attribute of the <span style="font-style: italic;"><span
 style="font-weight: bold;">query</span></span> element. The values
currently defined are "<span style="font-weight: bold;">paramValue</span>"
and "<span style="font-weight: bold;">template</span>". The <span
 style="font-style: italic;"><span style="font-weight: bold;">id</span></span>
and <span style="font-style: italic;"><span style="font-weight: bold;">template</span></span>
attributes of the <span style="font-style: italic;"><span
 style="font-weight: bold;">selector</span></span> elements are used in
the construction of the query string for either value of the <span
 style="font-style: italic;"><span style="font-weight: bold;">construct</span></span>
attribute. For the details of how to build the query string, see the <a
 href="#howQueryBuilt">"How is a Query String Built" section</a> below.<br>
</p>
<h3>resolverDataset</h3>
<pre><span style="color: rgb(255, 0, 0);">&lt;xsd:element name="resolverDataset" type="qc:resolverDatasetType" /&gt;</span><br
 style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">&lt;xsd:complexType name="resolverDatasetType"&gt;</span><br
 style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">  &lt;xsd:sequence&gt;</span><br
 style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    &lt;xsd:element ref="cat:service" /&gt;</span><br
 style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">    &lt;xsd:element ref="cat:access" use="required" /&gt;</span><br
 style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">  &lt;/xsd:sequence&gt;</span><br
 style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">  &lt;xsd:attribute name="name" type="xsd:string" /&gt;</span><br
 style="color: rgb(255, 0, 0);"><span style="color: rgb(255, 0, 0);">&lt;/xsd:complexType&gt;<br></span></pre>
<p>The <span style="font-style: italic;"><span
 style="font-weight: bold;">resolverDataset</span></span> element ...<br>
</p>
<a name="selector"></a>
<h3>selector Element</h3>
<pre>&lt;xsd:element name="selector" type="qc:selectorType" abstract="true"/&gt;<br>&lt;xsd:complexType name="selectorType"&gt;<br>  &lt;xsd:sequence&gt;<br>    &lt;xsd:element name="description" type="qc:includeXhtmlType" minOccurs="0" maxOccurs="1"/&gt;<br>  &lt;/xsd:sequence&gt;<br>  &lt;xsd:attribute name="id" type="xsd:token" use="optional"/&gt;<br>  &lt;xsd:attribute name="title" type="xsd:token" use="required"/&gt;<br>  &lt;xsd:attribute name="template" type="xsd:token" use="optional"/&gt;<br>  &lt;xsd:attribute name="required" type="xsd:boolean" default="true"/&gt;<br>  &lt;xsd:attribute name="multiple" type="xsd:boolean" default="false" /&gt;<br>&lt;/xsd:complexType&gt;<br></pre>
<p>The <span style="font-weight: bold; font-style: italic;">selector</span>
element is the base class for all selectors,
such as <a
 href="file:///C:/Documents%20and%20Settings/edavis/Desktop/DqcSpec.new.html#selectList">selectList</a>,
<a
 href="file:///C:/Documents%20and%20Settings/edavis/Desktop/DqcSpec.new.html#selectStation">selectStation</a>,
<a
 href="file:///C:/Documents%20and%20Settings/edavis/Desktop/DqcSpec.new.html#selectRange">selectRange</a>,
<a
 href="file:///C:/Documents%20and%20Settings/edavis/Desktop/DqcSpec.new.html#geographicSelection">selectGeoRegion</a>,
and defines a single selection for a user to make. The <span
 style="font-style: italic;"><span style="font-weight: bold;">required</span></span>
attribute which defaults to "<span style="font-weight: bold;">true</span>"
indicates whether the user must make a selection from this selector to
obtain a valid query string. The <em><strong>title</strong></em>
attribute is required and it's value is displayed to the user as the
title of this selector. The
contents of the optional <em><strong>description</strong></em> element
(plain text or a combination of text and XHTML) may
be displayed to the user to further describe the selector (see the <a
 href="#includeXhtmlType">"Elements of Type <span
 style="font-weight: bold;">includeXhtmlType</span>" section</a> for
more
information). The&nbsp;
<em><strong>id</strong></em> and the <span style="font-style: italic;"><span
 style="font-weight: bold;">template</span></span> attributes are both
optional and are used to build the query string. The <span
 style="font-style: italic;"><span style="font-weight: bold;">id</span></span>
attribute must be unique within a DQC document. The <span
 style="font-style: italic;"><span style="font-weight: bold;">multiple</span></span>
attribute which defaults to "<span style="font-weight: bold;">false</span>"
indicates whether the user can make only one selection from this <span
 style="font-style: italic;"><span style="font-weight: bold;">selector</span></span>
or can make many selections. E.g., from a <span
 style="font-style: italic;"><span style="font-weight: bold;">selector</span></span>
that allows the user to select from a list of stations, a user can
select one or more stations if <span style="font-style: italic;"><span
 style="font-weight: bold;">multiple</span></span> is set to "<span
 style="font-weight: bold;">true</span>". Otherwise, only one station
may be selected.</p>
<p>There are two ways the query string can be constructed corresponding
to the two allowed values of the <span style="font-style: italic;"><span
 style="font-weight: bold;">construct</span></span> attribute of the <span
 style="font-style: italic;"><span style="font-weight: bold;">query</span></span>
element. When the <span style="font-style: italic;"><span
 style="font-weight: bold;">construct</span></span> value is set to "<span
 style="font-weight: bold;">template</span>", the query string is
appended with the expanded value of the <span
 style="font-style: italic;"><span style="font-weight: bold;">template</span></span>
attribute from each <span style="font-style: italic;"><span
 style="font-weight: bold;">selector</span></span> element. The value
of the <span style="font-style: italic;"><span
 style="font-weight: bold;">template</span></span> attribute must be a
string containing one or more replacement strings. A replacement string
is any percent sign delimited string, e.g., "%min%". The template
string is expanded by replacing each replacement string with the
appropriate value from the selection. If the template contains more
than one replacement string, it means that the <span
 style="font-style: italic;"><span style="font-weight: bold;">selector</span></span>
requires more than one value to make a valid selection. This is
different than setting the <span style="font-style: italic;"><span
 style="font-weight: bold;">multiple</span></span> attribute to "<span
 style="font-weight: bold;">true</span>" which indicates that multiple
selections can be made on the <span style="font-style: italic;"><span
 style="font-weight: bold;">selector</span></span> whether each
selection requires one value or several values. When multiple
selections are made on the same <span style="font-style: italic;"><span
 style="font-weight: bold;">selector</span></span>, the template string
is appended to the query string once for each selection, expanded
appropriately.<br>
</p>
<p>When the <span style="font-style: italic;"><span
 style="font-weight: bold;">construct</span></span> value is set to "<span
 style="font-weight: bold;">paramValue</span>", the query string is
appended with parameter/value pairs where <span
 style="font-style: italic;"><span style="font-weight: bold;">id</span></span>
is the name of the parameter and the value from the users selection is
the parameters value, e.g., "min=5.3". The parameter value pairs from
each <span style="font-style: italic;"><span style="font-weight: bold;">selector</span></span>
are appended to the query string in a standard URL manner, e.g.,
"?min=5.3&amp;max=7.8", in the order the <span
 style="font-style: italic;"><span style="font-weight: bold;">selector</span></span>
elements appear in the DQC document. When multiple selections are made
on the same <span style="font-style: italic;"><span
 style="font-weight: bold;">selector</span></span>, the parameter/value
pair for that <span style="font-style: italic;"><span
 style="font-weight: bold;">selector</span></span> is appended to the
query string once for each selection using the value of that selection
as the parameter value.<br>
</p>
<p>More information on how the <em><strong>id</strong></em>, <span
 style="font-style: italic;"><span style="font-weight: bold;">template</span></span>,
and <span style="font-style: italic;"><span style="font-weight: bold;">multiple</span></span>
attributes are used in the building of the query string is available in
the <a href="#howQueryBuilt">"How is a Query String Built" section</a>
below.</p>
<a name="includeXhtmlType"></a>
<h3>elements of type includeXhtmlType<br>
</h3>
<pre>&lt;xsd:complexType name="includeXhtmlType" mixed="true"&gt;<br>  &lt;xsd:sequence&gt;<br>    &lt;xsd:any namespace="http://www.w3.org/1999/xhtml"<br>            &nbsp;minOccurs="0" maxOccurs="unbounded"<br>            &nbsp;processContents="lax"/&gt;<br>  &lt;/xsd:sequence&gt;<br>&lt;/xsd:complexType&gt;</pre>
<p>Elements of&nbsp; this type can contain plain text or a combination
of text and
XHTML tags. For example, a <span style="font-style: italic;"><span
 style="font-weight: bold;">description</span></span> element could be
plain text:<br>
</p>
<pre>&lt;description&gt;<br>  There are three parameter choices for this dataset: sea surface temperature; wave heights; and wind direction.<br>&lt;/description&gt;<br></pre>
<p>or<br>
</p>
<pre>&lt;description&gt;<br>  &lt;p&gt;There are three parameter choices for this dataset:&lt;/p&gt;<br>  &lt;ul&gt;<br>    &lt;li&gt;sea surface temperature;&lt;/li&gt;<br>    &lt;li&gt;wave heights; and&lt;/li&gt;<br>    &lt;li&gt;wind direction.&lt;/li&gt;<br>  &lt;/ul&gt;<br>&lt;/description&gt;<br></pre>
<pre></pre>
<a name="selectList"></a>
<h3>selectList Element</h3>
<pre>&lt;xsd:element name="selectList" type="qc:selectListType" substitutionGroup="qc:selector"/&gt;<br>&lt;xsd:complexType name="selectListType"&gt;<br>  &lt;xsd:complexContent&gt;<br>    &lt;xsd:extension base="qc:selectorType"&gt;<br>      &lt;xsd:sequence&gt;<br>        &lt;xsd:element ref="qc:choice" minOccurs="1" maxOccurs="unbounded"/&gt;<br>      &lt;/xsd:sequence&gt;<br>    &lt;/xsd:extension&gt;<br>  &lt;/xsd:complexContent&gt;<br>&lt;/xsd:complexType&gt;<br></pre>
<p>A <em><strong>SelectList</strong></em> is a kind of
selector that
allows the user to make a selection from an enumerated list of <strong>choice</strong>
elements.<br>
</p>
<p>When the query construct method is set to "<span
 style="font-weight: bold;">template</span>", the template string must
contain only one replacement string. The template string does not have
to be related to the <span style="font-style: italic;"><span
 style="font-weight: bold;">id</span></span> of the <span
 style="font-style: italic;"><span style="font-weight: bold;">selector</span></span>,
if one is given. No matter the actual replacement string used, it will
be replaced with the value of the selection.<br>
</p>
<p>When the "<span style="font-weight: bold;">paramValue</span>" query
construct method is chosen, the parameter name will be the value of the
<span style="font-style: italic;"><span style="font-weight: bold;">id</span></span>
or "item" if no id is given, i.e., "&lt;id&gt;=&lt;value&gt;" or
"item=&lt;value&gt;".<br>
</p>
<a name="choice"></a>
<h3>choice Element</h3>
<pre>&lt;xsd:element name="choice" type="qc:choiceType"/&gt;<br>&lt;xsd:complexType name="choiceType"&gt;<br>  &lt;xsd:sequence&gt;<br>    &lt;xsd:element ref="qc:selector" minOccurs="0" maxOccurs="unbounded"/&gt;<br>  &lt;/xsd:sequence&gt;<br>  &lt;xsd:attribute name="name" type="xsd:string" use="required"/&gt;<br>  &lt;xsd:attribute name="value" type="xsd:string" use="required"/&gt;<br>  &lt;xsd:attribute name="description" type="xsd:string" use="optional"/&gt;<br>&lt;/xsd:complexType&gt;<br></pre>
<p>A <span style="font-weight: bold; font-style: italic;">choice</span>
element specifies a single choice that the user can make
from a <span style="font-weight: bold; font-style: italic;">selectList</span>.
The <em><strong>name</strong></em> attribute is
displayed to the user, while the <em><strong>description</strong></em>
is an optional longer description of the choice. The <em><strong>value</strong></em>
attribute of a selected choice provides the selections resulting value
which is used to construct the query.<br>
</p>
<p>[<span style="color: rgb(255, 0, 0);">Should the
description here be
an element with mixed (XHTML) content, or stay as an attribute string?</span>]<br>
</p>
<a name="selectStation"></a>
<h3> selectStation Element</h3>
<pre>&lt;xsd:element name="selectStation" type="qc:selectStationType" substitutionGroup="qc:selector"/&gt;<br>&lt;xsd:complexType name="selectStationType"&gt;<br>  &lt;xsd:complexContent&gt;<br>    &lt;xsd:extension base="qc:selectorType"&gt;<br>      &lt;xsd:sequence&gt;<br>        &lt;xsd:element ref="qc:station" minOccurs="1" maxOccurs="unbounded"/&gt;<br>      &lt;/xsd:sequence&gt;<br>    &lt;/xsd:extension&gt;<br>  &lt;/xsd:complexContent&gt;<br>&lt;/xsd:complexType&gt;<br></pre>
<p>A <em><strong>selectStation</strong></em> is a kind of <span
 style="font-weight: bold; font-style: italic;">selector</span>
that allows the user to select from an enumerated list of <strong>station</strong>
elements. It is similar to the <span style="font-style: italic;"><span
 style="font-weight: bold;">selectList</span></span> element but
specialized to handle geographically located stations.<br>
</p>
<p>When the construct method is set to "template", the template string
must contain exactly one replacement string. The template string does
not have to be related to the id of the selector, if one is given. No
matter the actual replacement string used, it will be replaced with the
value of the selection. When the "paramValue" construct method is
chosen, the parameter name will be the value of the id or "stn" if no
id is given, i.e., "&lt;id&gt;=&lt;value&gt;" or "stn=&lt;value&gt;".<br>
</p>
<a name="station"></a>
<h3>station Element</h3>
<pre>&lt;xsd:element name="station" type="qc:stationType" substitutionGroup="qc:choice"/&gt;<br>&lt;xsd:complexType name="stationType"&gt;<br>  &lt;xsd:complexContent&gt;<br>    &lt;xsd:extension base="qc:choiceType"&gt;<br>      &lt;xsd:sequence&gt;<br>        &lt;xsd:element ref="qc:location"/&gt;<br>      &lt;/xsd:sequence&gt;<br>    &lt;/xsd:extension&gt;<br>  &lt;/xsd:complexContent&gt;<br>&lt;/xsd:complexType&gt;<br></pre>
<p>A <em><strong>station</strong></em> element is an
extention of a
choice element that is specific to geographically located stations in
that it specifies a location. It contains exactly one <strong>location</strong>
element. It inherits the <strong>name</strong>, <strong>description</strong>
and <strong>value</strong> attributes from the <strong>choice</strong>
type. It is used in conjunction with the <span
 style="font-weight: bold; font-style: italic;">selectStation</span>
element.<br>
</p>
<a name="location"></a>
<h3>location Element</h3>
<pre>&lt;xsd:element name="location" type="qc:locationType"/&gt;<br>&lt;xsd:complexType name="locationType"&gt;<br>  &lt;xsd:attribute name="latitude" type="xsd:float" use="required"/&gt;<br>  &lt;xsd:attribute name="longitude" type="xsd:float" use="required"/&gt;<br>  &lt;xsd:attribute name="latitude_units" type="xsd:token" default="degrees"/&gt;<br>  &lt;xsd:attribute name="longitude_units" type="xsd:token" default="degrees"/&gt;<br>&lt;/xsd:complexType&gt;<br></pre>
<p>A <em><strong>location</strong></em> element has a <strong><em>latitude</em></strong>
and <strong><em>longitude</em></strong>, and optionally may contain
units for the latitude and longitude<em><strong></strong></em>.
The units default to "degrees", meaning decimal degrees. The convention
for longitude is that 0 is greenwich, with positive going east, and the
numbers will be interpreted modulo 360. The default for latittude is 0
is the equator with positive going north, and must be in the range +/-
90.</p>
<a name="location3D"></a>
<h3>location3D Element</h3>
<pre>&lt;xsd:element name="location3D" type="qc:location3D" substitutionGroup="qc:location"/&gt;<br>&lt;xsd:complexType name="location3D"&gt;<br>  &lt;xsd:complexContent&gt;<br>    &lt;xsd:extension base="qc:locationType"&gt;<br>      &lt;xsd:attribute name="elevation" type="xsd:float" use="required"/&gt;<br>      &lt;xsd:attribute name="elevation_units" type="xsd:token" default="msl"/&gt;<br>    &lt;/xsd:extension&gt;<br>  &lt;/xsd:complexContent&gt;<br>&lt;/xsd:complexType&gt;<br></pre>
<p>A <strong><em>location3D</em></strong> element extends
the <strong>location</strong>
type by adding an <em><strong>elevation</strong></em> attribute to
indicate the vertical location. The <em><strong>elevation_unit</strong></em><strong><em>s</em></strong>
attribute specifies the units of the elevation.</p>
<a name="selectFromRange"></a>
<h3> selectFromRange Element</h3>
<pre>&lt;xsd:element name="selectFromRange" type="qc:selectFromRangeType" substitutionGroup="qc:selector" /&gt;<br>&lt;xsd:complexType name="selectFromRangeType"&gt;<br>  &lt;xsd:complexContent&gt;<br>    &lt;xsd:extension base="qc:selectorType"&gt;<br>      &lt;xsd:attribute name="min" type="xsd:float" /&gt;<br>      &lt;xsd:attribute name="max" type="xsd:float" /&gt;<br>      &lt;xsd:attribute name="units" type="xsd:string" /&gt;<br>    &lt;/xsd:extension&gt;<br>  &lt;/xsd:complexContent&gt;<br>&lt;/xsd:complexType&gt;<br></pre>
<p>A <em><strong>selectFromRange</strong></em> element is a kind of
<span style="font-weight: bold; font-style: italic;">selector</span>
that
allows the user to select a range of numbers from the range given by
the values of the <span style="font-style: italic;"><span
 style="font-weight: bold;">min</span></span> and <span
 style="font-style: italic;"><span style="font-weight: bold;">max</span></span>
attributes.The
range that the user
chooses must lie within the given range. The <em><strong>units</strong></em>
attribute provides the units that the minimum and maximum values are
given in and should be displayed to
the user.<br>
</p>
<p>This <span style="font-style: italic;"><span
 style="font-weight: bold;">selector</span></span> <span
 style="color: rgb(255, 0, 0);"><span style="color: rgb(0, 0, 0);">requires
the template attribute to indicate what values are required, i.e., this
selector can only be used when the "template" query construct method is
selected. The template&nbsp; must contain these replacement strings as
indicated:<br>
</span></span></p>
<ul>
  <li><span style="color: rgb(255, 0, 0);"><span
 style="color: rgb(0, 0, 0);">%min% and %max% OR </span></span><span
 style="color: rgb(255, 0, 0);"><span style="color: rgb(0, 0, 0);">%point%
and %proximity% (%proximity% defaults to "closest", other allowed
values are "closestAbove" and "closestBelow")</span></span></li>
  <li><span style="color: rgb(255, 0, 0);"><span
 style="color: rgb(0, 0, 0);">AND </span></span><span
 style="color: rgb(255, 0, 0);"><span style="color: rgb(0, 0, 0);">%units%,
(defaults to the units provided)</span></span></li>
</ul>
<p>[<span style="color: rgb(255, 0, 0);">How do we know that we are
dealing with a date range? If time units are specified? Or an attribute
that indicates that the range is on a special axis, e.g., time, lat,
long?&nbsp; Would we need an attribute to indicate positive direction?</span>]</p>
<p></p>
<a name="selectGeoRegion"></a>
<h3>selectGeoRegion Element</h3>
<pre>&lt;xsd:element name="selectGeoRegion" type="qc:selectGeoRegionType" substitutionGroup="qc:selector"/&gt;<br>&lt;xsd:complexType name="selectGeoRegionType"&gt;<br>  &lt;xsd:complexContent&gt;<br>    &lt;xsd:extension base="qc:selectorType"&gt;<br>      &lt;xsd:sequence&gt;<br>        &lt;xsd:element ref="qc:boundingBox"/&gt;<br>      &lt;/xsd:sequence&gt;<br>    &lt;/xsd:extension&gt;<br>  &lt;/xsd:complexContent&gt;<br>&lt;/xsd:complexType&gt;<br></pre>
<p>A <em><strong>selectGeoRegion</strong></em> is a kind of
selector that allows the user to define a lat/lon bounding box that the
data should be contained in (intersect?).<br>
</p>
<p>This selector requires the template attribute to indicate what
values are required, i.e., this selector can only be used when the
"template" query construct method is selected. The template must
contain these replacement strings as indicated:<br>
</p>
<ul>
  <li>%minLat%, %maxLat%, %minLon%, and %maxLon%</li>
  <li>OR %upperLeftLat%, %upperLeftLon%, %upperRightLat%,
%upperRightLon%, %lowerLeftLat%, %lowerLeftLon%, %lowerRightLat%, and
%lowerRightLon%</li>
  <li>OR %polyLat1%, %polyLon1%, %polyLat2%, %polyLon2%, ...
%polyLatN%, and %polyLonN%<br>
  </li>
</ul>
<a name="boundingBox"></a>
<h3>boundingBox Element</h3>
<pre>&lt;xsd:element name="boundingBox" type="qc:boundingBoxType"/&gt;<br>&lt;xsd:complexType name="boundingBoxType"&gt;<br>  &lt;xsd:sequence&gt;<br>    &lt;xsd:element name="upperLeft" type="qc:locationType"/&gt;<br>    &lt;xsd:element name="upperRight" type="qc:locationType"/&gt;<br>    &lt;xsd:element name="lowerLeft" type="qc:locationType"/&gt;<br>    &lt;xsd:element name="lowerRight" type="qc:locationType"/&gt;<br>  &lt;/xsd:sequence&gt;<br>&lt;/xsd:complexType&gt;<br><br></pre>
<p>A <strong><em>BoundingBox</em></strong> element defines
a lat/lon
bounding box using <em><strong>upperLeft, upperRight, lowerLeft</strong></em>,
and <em><strong>lowerRight</strong></em> elements which are <span
 style="font-style: italic;"><span style="font-weight: bold;">location</span></span>
elements. An
altitude range can also be specified by using location3D elements [<span
 style="color: rgb(255, 0, 0);">You could end up with four elevations.
What would that mean?</span>].<br>
</p>
<a name="userInterface"></a>
<h3>userInterface Element</h3>
<pre>&lt;xsd:element name="userInterface" type="qc:userInterfaceType"/&gt;<br>&lt;xsd:complexType name="userInterfaceType"&gt;<br>  &lt;xsd:sequence&gt;<br>    &lt;xsd:any minOccurs="0" maxOccurs="unbounded" processContents="skip"/&gt;<br>  &lt;/xsd:sequence&gt;<br>&lt;/xsd:complexType&gt;<br></pre>
<p>A <em><strong>userInterface</strong></em> element is a
container
for zero or more elements that can be anything.</p>
<br>
<hr>
<h2>Example</h2>
<p>Here is an example THREDDS dataset that, when accessed, results in a
DQC document (note, the serviceType is "queryCapability"):<br>
</p>
<pre>&lt;dataset name="NEXRAD data" &gt;<br>  &lt;access serviceType="queryCapability" urlPath="http://www/dqc/radar.xml" /&gt;<br>&lt;/dataset&gt;<br></pre>
<p>The resulting DQC document:<br>
</p>
<pre>&lt;queryCapability&gt;<br>  &lt;query construct="paramValue" &gt;<br>    &lt;resolverDataset name="NEXRAD data"&gt;<br>      &lt;access serviceType="Resolver" urlPath="http://www/dqc/radar" /&gt; &lt;!-- service type depends on what selections are made. E.g., --&gt;<br>                                                                       &lt;!-- if station only is selected, might return a DQC but --&gt;<br>                                                                       &lt;!-- if station, product, and latest selected, return coherent collection with collectionType="timeSeries" --&gt;<br>                                                                       &lt;!-- OR is it always serviceType="Resolver" --&gt;<br>    &lt;/resolverDataset&gt;<br>  &lt;/query&gt;<br><br>  &lt;selectStation id="station" title="Stations:"<br>    multiple="true" required="true"&gt;<br><br>    &lt;station name="ANCHORAGE/Bethel AK" value="ABC"&gt;<br>      &lt;location latitude="60.78" longitude="-161.87"/&gt;<br>    &lt;/station&gt;<br>    &lt;station name="ABERDEEN/Aberdeen SD" value="ABR"&gt;<br>      &lt;location latitude="45.45" longitude="-98.4"/&gt;<br>    &lt;/station&gt;<br>  &lt;/selectStation&gt;<br><br>  &lt;selectList id="product" title="Products:"<br>    multiple="true" required="true"&gt;<br><br>    &lt;choice name=".5 reflectivity .54nm res" value="N0R"<br>      description=".5 reflectivity .54nm res 16 levels id 19/r"/&gt;<br>    &lt;choice name=".5 storm rel. velocity" value="N0S"<br>      description=".5 storm rel. velocity .54nm res 16 lvls id 56/srm"/&gt;<br>  &lt;/selectList&gt;<br><br>  &lt;selectList id="time" title="Times:" required="true"&gt;<br>    &lt;choice name="Latest" value="latest"/&gt;<br>    &lt;choice name="Last hour" value="1hour"/&gt;<br>  &lt;/selectList&gt;<br>&lt;/queryCapability&gt;</pre>
<p>From the given DQC document, the client (e.g., a user interface)
builds a resolver dataset (note, the serviceType is "Resolver"):<br>
</p>
<pre>&lt;dataset name="NEXRAD data"&gt;<br>  &lt;access serviceType="Resolver" urlPath="http://www/dqc/radar?stn=ABC&amp;stn=ABR&amp;product=NOS&amp;time=latest" /&gt;<br>&lt;/dataset&gt;<br></pre>
<p>The resolver dataset when accessed resolves into, in this case, a
coherant collection dataset with collectionType="stations":<br>
</p>
<pre>&lt;catalog&gt;<br>  &lt;dataset name="Latest NOS NEXRAD product from ABC and ABR" collectionType="stations"&gt;<br>    &lt;service name="mlode" base="http://www/data/radar" /&gt;<br>    &lt;dataset name="Latest .5 storm relative velocity product from Bethel, AK"&gt;<br>        &lt;access serviceName="mlode" urlType="NOS/ABC/2003121600_NOS.nc" /&gt;<br>    &lt;/dataset&gt;<br>    &lt;dataset name="Latest .5 storm relative velocity product from Aberdeen, SD"&gt;<br>        &lt;access serviceName="mlode" urlType="NOS/ABR/2003121600_NOS.nc" /&gt;<br>    &lt;/dataset&gt;<br>  &lt;/dataset&gt;<br>&lt;/catalog&gt;<br></pre>
<hr><br>
<h2>Notes</h2>
<a name="whatReturned"></a>
<h3>What is Returned</h3>
<p>Currently, a resulting queryURL can return a THREDDS catalog. DQC
documents could be used to build queryURLs that reference non-THREDDS
services, e.g., an OPeNDAP server. The results of dereferencing a
queryURL in these cases would be dependent on the service and,
currently, can not
be represented in the DQC document other than with an "other" value in
the returns attribute of the query element. How a queries returns type
is indicated may need to be expanded if the DQC is used in other
contexts.<br>
</p>
<h4>Further Discussion of Return Type</h4>
<p>We have decided not to investigate other return types until we have
more need for them.<br>
</p>
<p>Some thoughts:<br>
</p>
<ul>
  <li>What is the DQC:</li>
  <ul>
    <li>a redirection layer</li>
    <li>a more complex access method (a subsetting access method)<br>
    </li>
  </ul>
  <li>What is the result of the DQC:</li>
  <ul>
    <li>a queryURL that returns catalog (no crossing of the protocol
boundary)</li>
    <li>a queryURL that returns a dataset, e.g., DODS data (cross the
protocol boundary)</li>
    <ul>
      <li>Can't allow client to get queryURL and then try to constrain
further. E.g., ?xy[10:13]?xy[0] causes error instead of returning
xy[10] of the original var. However, since a DQC result is generally a
final result that is then dereferenced this shouldn't happen. Is this
related to the "Resolver" idea? Could we use the DQC to provide more
information on "Resolver" issues? E.g., if time range is selected,
result is a "time series".<br>
      </li>
    </ul>
    <li>a catalog, i.e., tempate as catalog. For example
template="&lt;catalog&gt;&lt;dataset urlpath=%path%&gt;&lt;service
name="xyz"/&gt;&lt;metadata&gt;abc&lt;/metadata&gt;&lt;/dataset&gt;"</li>
    <ul>
      <li>This keeps things more cleanly in the THREDDS realm (i.e.,
queryURL is the access method)<br>
      </li>
    </ul>
  </ul>
  <li>the queryURL is a urlPath of a dataset (e.g., DODS URL w/ CE)</li>
  <li>DQC just another way to build an access URL (like serviceBase +
urlPath) but that allows subsetting<br>
  </li>
  <ul>
    <li>How differentiate between access to full dataset and subset of
dataset?</li>
  </ul>
</ul>
<h4>DODS File Server (DFS) Thoughts</h4>
<p>Several possibilities:<br>
</p>
<ul>
  <li>Build DQC documents that build a DFS query. So return is a DODS
dataset containing catalog information.</li>
  <ul>
    <li>Pros</li>
    <ul>
      <li>Could be done<br>
      </li>
    </ul>
    <li>Cons</li>
    <ul>
      <li>Requires crossing of THREDDS/DODS protocol boundary before
out of catalog realm<br>
      </li>
    </ul>
    <ul>
      <li>Might require some added complexity to the DQC spec?<br>
      </li>
      <li>No metadata for each dataset except for selection criterion
columns<br>
      </li>
    </ul>
  </ul>
  <li>Build DQC document that describes a DFS and service that replys
with THREDDS catalog. <br>
  </li>
  <ul>
    <li>On top of existing DFS</li>
    <li>Replace existing DFS<br>
    </li>
  </ul>
</ul>
<a name="howQueryBuilt"></a>
<h3>How is a Query String Build</h3>
<p>To build a query string from a DQC document, the user makes a
selection for each <span style="font-weight: bold; font-style: italic;">selector</span>
element that is required (the <span
 style="font-weight: bold; font-style: italic;">require</span>
attribute defaults to "<span style="font-weight: bold;">true</span>")
and optionally for each <span
 style="font-weight: bold; font-style: italic;">selector</span> element
that is not required. How the user selections are used to build the
query string depends on the value of the <span
 style="font-style: italic;"><span style="font-weight: bold;">construct</span></span>
attribute of the&nbsp; DQC document's <span style="font-style: italic;"><span
 style="font-weight: bold;">query</span></span> element. The construct
types
currently defined are "<span style="font-weight: bold;">paramValue</span>"
and "<span style="font-weight: bold;">template</span>". The <span
 style="font-style: italic;"><span style="font-weight: bold;">id</span></span>
and <span style="font-style: italic;"><span style="font-weight: bold;">template</span></span>
attributes (both optional) of the <span style="font-style: italic;"><span
 style="font-weight: bold;">selector</span></span> elements are used in
the construction of the query string for either value of the <span
 style="font-style: italic;"><span style="font-weight: bold;">construct</span></span>
attribute.<br>
</p>
<p>What constitutes a valid selection is defined by the <span
 style="font-weight: bold; font-style: italic;">selector</span>
element. Some selections may consist of a single value,e.g., a station
selection requires the station name. Other selections may require
multiple values, e.g., both a minimum value and a maximum value are
required to select a time range. (Note that this is different than
allowing multiple selections from the same <span
 style="font-weight: bold; font-style: italic;">selector</span>
element, see the discussion of the <span
 style="font-weight: bold; font-style: italic;">multiple</span>
attribute <a href="#multiple">below</a>.) The <span
 style="font-weight: bold; font-style: italic;">selector</span> element
defines the values required for a given selection in various ways
depending on the construction type.<br>
</p>
When the <span style="font-style: italic;"><span
 style="font-weight: bold;">construct</span></span> value is set to "<span
 style="font-weight: bold;">template</span>", each <span
 style="font-style: italic;"><span style="font-weight: bold;">selector</span></span>
element must have a <span
 style="font-weight: bold; font-style: italic;">template</span>
attribute. Each template string (the value of the <span
 style="font-weight: bold; font-style: italic;">template</span>
attribute) is expanded and appended to the query string in the same
order as the <span style="font-weight: bold; font-style: italic;">selector</span>
elements are found in the DQC document. A template string must be a
string containing one or more replacement strings. A replacement string
is any percent sign delimited string, e.g., "%min%". To expand a
template
string, each replacement string is replaced with the appropriate value
from the selection. The number and names of the replacement strings
defines the values required to make a valid selection.<br>
<p>
When the <span style="font-style: italic;"><span
 style="font-weight: bold;">construct</span></span> value is set to "<span
 style="font-weight: bold;">paramValue</span>", the query string is
appended with parameter/value pairs where <span
 style="font-style: italic;"><span style="font-weight: bold;">id</span></span>
is the name of the parameter and the value from the users selection is
the parameters value, e.g., "stn=AKC". The parameter value pairs from
each <span style="font-style: italic;"><span style="font-weight: bold;">selector</span></span>
are appended to the query string using the standard URL-encoding rules,
e.g.,
"?stn=AKC&amp;time=latestDay", in the order the <span
 style="font-style: italic;"><span style="font-weight: bold;">selector</span></span>
elements appear in the DQC document.<br>
</p>
<p><a name="multiple"></a>The <span
 style="font-weight: bold; font-style: italic;">multiple</span>
attribute when set to "<span style="font-weight: bold;">true</span>"
(the default is "<span style="font-weight: bold;">false</span>") means
that the user may make more than one selection from a single <span
 style="font-weight: bold; font-style: italic;">selector</span>. When
more than one selection is made from the same <span
 style="font-weight: bold; font-style: italic;">selector</span>, the
information for each selection is simply appended to the query string
in the manner defined by the construction type. The information for
each selection must be appended as an atomic unit, i.e., if multiple
values are required, the values from the same selection are together
(e.g., "min=1&amp;max=2&amp;min=5&amp;max=6" rather than
"min=1&amp;min=5&amp;max=2&amp;max=6". The order of the selections is
not defined (e.g., either "min=1&amp;max=2&amp;min=5&amp;max=6" or
"min=5&amp;max=6&amp;min=1&amp;max=2"
is fine).</p>
<h3><span style="color: rgb(0, 0, 0);">How to Indicate a Selector
Requires More than One Value (or Replacement Strings/Macros vs
Selection Items)</span></h3>
<h4>Macros (Replacement Strings)</h4>
<p>Currently, selectors that require multiple values are indicated by
the template containing multiple replacement strings (or macros), e.g.,
template="min=%min%max=%max%". The set of allowed replacement strings
is defined (in the spec only) for each selector that requires multiple
values. Which combinations of the replacement strings are also defined
only in the spec. For instance, the <span
 style="font-weight: bold; font-style: italic;">selectFromRange</span>
element defines %min%, %max%, %units%, %point%, and %proximity% where
there are two possibilities for use. Either %min% and %max% may be used
or %point% and %proximity% may be used (though %proximity% is
optional). In both cases %units% may be used.<br>
</p>
<p>Pros<br>
</p>
<ul>
  <li>simple</li>
  <li>template can be fairly complicated</li>
</ul>
<p>Cons<br>
</p>
<ul>
  <li>Does not take advantage of XML encoding for structured
information. I.e., requires the apps (not XML parser) to parse
attribute structure. (If
attribute needs structure, maybe it should be an element.)</li>
  <li>can't be used when construction type is "paramValue" (or rather
it can't be guarenteed that the template fits in the "paramValue"
scheme)???</li>
  <li>when elements aren't required and or multiple selections are
allowed, can be hard to get delimiters between values correct. E.g., if
all selectors are optional and no selection on the final selector is
made, might end up with "...?min=5&amp;max=6&amp;stn=AKC&amp;"<br>
  </li>
</ul>
<h4>Selection Items</h4>
Alternate:<br>
<ul>
  <li><span style="font-weight: bold; font-style: italic;">queryCapability</span>
element contains 0..* <span
 style="font-weight: bold; font-style: italic;">selection</span>
elements</li>
  <li><span style="font-style: italic;"><span style="font-weight: bold;">selection</span></span>
element contains 0..* <span style="font-style: italic;"><span
 style="font-weight: bold;">selectionItem</span></span> elements</li>
  <li><span style="font-style: italic;"><span style="font-weight: bold;">selectionItem</span></span>
elements have <span style="font-style: italic;"><span
 style="font-weight: bold;">id</span></span> attributes that are used
as id in "paramValue" scheme or in template</li>
</ul>
<p>For <span style="font-weight: bold; font-style: italic;">selectors</span>
that require a single value to make a selection, this can work the same
as above except that the template macro name or parameter name are
defined by <span style="font-weight: bold; font-style: italic;">selection</span>
id value. However, if a <span
 style="font-weight: bold; font-style: italic;">selectionItem</span>
element is present, then all is the same as above except that the <span
 style="font-weight: bold; font-style: italic;">selectionItem</span> id
value defines the template macro name or parameter name.<br>
</p>
<p>For <span style="font-weight: bold; font-style: italic;">selectors</span>
that require multiple values to make a selection, <span
 style="font-weight: bold; font-style: italic;">selectionItem</span>
elements are required for each of the required values. The id of each <span
 style="font-weight: bold; font-style: italic;">selectionItem</span>
element is used to define the template macro names or parameter names.<br>
</p>
<p>An example DQC that shows the above methods and this method is
available at <a href="./DqcExample-twoDFS.xml">DqcExample-twoDFS.xml</a><br>
</p>
<h3>selectionItem element<br>
</h3>
<pre>&lt;xsd:element name="selectionItem" type="" abstract="true" /&gt;<br>&lt;xsd:complexType name="selectionItemType"&gt;<br>  &lt;xsd:attribute name="id" type="xsd:token" use="required"/&gt;<br>&lt;/xsd:complexType&gt;<br></pre>
<p>The <span style="font-style: italic;"><span
 style="font-weight: bold;">selectionItem</span></span> element ...
Possible element to indicate that multiple values are required for the
containing selector.<br>
</p>
<h3>selectFromRange2 element<br>
</h3>
<pre>&lt;xsd:element name="selectFromRange2" type="qc:selectFromRange2Type" substitutionGroup="qc:selector" /&gt;<br>&lt;xsd:complexType name="selectFromRange2Type"&gt;<br>  &lt;xsd:complexContent&gt;<br>    &lt;xsd:extension base="qc:selectorType"&gt;<br>      &lt;xsd:sequence&gt;<br>        &lt;xsd:choice&gt;<br>          &lt;xsd:sequence&gt;<br>            &lt;xsd:element ref="qc:selectedMin" /&gt;<br>            &lt;xsd:element ref="qc:selectedMax" /&gt;<br>          &lt;/xsd:sequence&gt;<br>          &lt;xsd:sequence&gt;<br>            &lt;xsd:element ref="qc:selectedPoint" /&gt;<br>            &lt;xsd:element ref="qc:selectedProximity" minOccurs="0" /&gt;<br>          &lt;/xsd:sequence&gt;<br>        &lt;/xsd:choice&gt;<br>        &lt;xsd:element ref="qc:selectedUnits" minOccurs="0" maxOccurs="1" /&gt;<br>      &lt;/xsd:sequence&gt;<br>      &lt;xsd:attribute name="min" type="xsd:float" /&gt;<br>      &lt;xsd:attribute name="max" type="xsd:float" /&gt;<br>      &lt;xsd:attribute name="units" type="xsd:float" /&gt;<br>    &lt;/xsd:extension&gt;<br>  &lt;/xsd:complexContent&gt;<br>&lt;/xsd:complexType&gt;<br><br>&lt;xsd:element name="selectedMin" type="qc:selectedFloatValueType" substitutionGroup="qc:selectionItem" /&gt;<br>&lt;xsd:element name="selectedMax" type="qc:selectedFloatValueType" substitutionGroup="qc:selectionItem" /&gt;<br>&lt;xsd:element name="selectedPoint" type="qc:selectedFloatValueType" substitutionGroup="qc:selectionItem" /&gt;<br>&lt;xsd:element name="selectedProximity" type="qc:selectedProximityValueType" substitutionGroup="qc:selectionItem" /&gt;<br>&lt;xsd:element name="selectedUnits" type="qc:selectedStringValueType" substitutionGroup="qc:selectionItem" /&gt;<br><br>&lt;xsd:complexType name="selectedFloatValueType"&gt;<br>  &lt;xsd:complexContent&gt;<br>    &lt;xsd:extension base="qc:selectionItemType"&gt;<br>      &lt;xsd:attribute name="value" type="xsd:float" /&gt;<br>    &lt;/xsd:extension&gt;<br>  &lt;/xsd:complexContent&gt;<br>&lt;/xsd:complexType&gt;<br><br>&lt;xsd:complexType name="selectedStringValueType"&gt;<br>  &lt;xsd:complexContent&gt;<br>    &lt;xsd:extension base="qc:selectionItemType"&gt;<br>      &lt;xsd:attribute name="value" type="xsd:string" /&gt;<br>    &lt;/xsd:extension&gt;<br>  &lt;/xsd:complexContent&gt;<br>&lt;/xsd:complexType&gt;<br><br>&lt;xsd:complexType name="selectedProximityValueType"&gt;<br>  &lt;xsd:complexContent&gt;<br>    &lt;xsd:extension base="qc:selectionItemType"&gt;<br>      &lt;xsd:attribute name="value" type="qc:proximityType" default="closest" /&gt;<br>    &lt;/xsd:extension&gt;<br>  &lt;/xsd:complexContent&gt;<br>&lt;/xsd:complexType&gt;<br><br>&lt;xsd:simpleType name="proximityType"&gt;<br>  &lt;xsd:restriction base="xsd:token"&gt;<br>    &lt;xsd:enumeration value="closest" /&gt;<br>    &lt;xsd:enumeration value="closestAbove" /&gt;<br>    &lt;xsd:enumeration value="closestBelow" /&gt;<br>  &lt;/xsd:restriction&gt;<br>&lt;/xsd:simpleType&gt;<br></pre>
<p>Example:<br>
</p>
<pre>&lt;selectFromRange name="DateRange" description="The date range ..." required="false"<br>                 min="-5.0" max="0.0" units="days since present"&gt;<br>  &lt;selectedMin id="minDate" /&gt;<br>  &lt;selectedMax id="maxDate" /&gt;<br>&lt;/selectDateRange&gt;</pre>
<p><span style="color: rgb(255, 0, 0);">LOOK</span> Note the
propposed
way of specing the reletive time.</p>
<br>
<hr>
<address><a href="mailto:edavis@ucar.edu">Ethan Davis</a></address>
</body>
</html>
